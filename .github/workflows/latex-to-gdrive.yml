name: Compile LaTeX and Upload to Google Drive

on:
  push:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. Clonar repo
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Instalar y comparar LaTeX
      - name: Compile LaTeX document
        uses: xu-cheng/latex-action@v4
        with:
          root_file: main.tex

        
      - name: Upload PDF as artifact
        uses: actions/upload-artifact@v4
        with:
          name: thesis-pdf
          path: main.pdf

      # 4. Empaquetar resultados
      - name: Package PDF
        run: mkdir build && cp main.pdf build/

      # 5. Subir a Google Drive
      - name: Upload to Google Drive
        uses: satackey/action-google-drive@v1
        with:
          service_account_key: ${{ secrets.GDRIVE_CREDENTIALS }}
          upload_file: ./build/main.pdf
          drive_file: main.pdf
